<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        /* Shared styles */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        /* Config page styles */
        .config-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
        }

        .config-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .config-input {
            margin: 10px 0;
        }

        .config-input label {
            display: block;
            margin-bottom: 5px;
        }

        .config-input input, .config-input select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            background: #9147ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #7527e0;
        }

        #configUrl {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            word-break: break-all;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Overlay styles */
        .overlay-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #alertBox {
            position: absolute;
            left: 50%;
            top: 20%;
            transform: translateX(-50%);
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        #customText {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <script>
        // Check if this is the config page or overlay
        const isConfig = window.location.hash === '#config';

        // Generate a random user ID if needed
        function generateUserId() {
            return Math.random().toString(36).substring(2, 15);
        }

        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                userId: params.get('userId'),
                text: params.get('text'),
                action: params.get('action'),
                alertDuration: params.get('alertDuration'),
                alertColor: params.get('alertColor'),
                defaultText: params.get('defaultText'),
                position: params.get('position')
            };
        }

        // Save configuration
        function saveConfig() {
            const userId = $('#userId').val();
            const config = {
                alertDuration: $('#alertDuration').val(),
                alertColor: $('#alertColor').val(),
                defaultText: $('#defaultText').val(),
                position: $('#position').val()
            };
            
            localStorage.setItem(`overlayConfig_${userId}`, JSON.stringify(config));
            updateConfigUrl(userId, config);
            alert('Configuration saved!');
        }

        // Load configuration
        function loadConfig(userId) {
            // First try URL parameters
            const urlParams = getUrlParams();
            if (urlParams.alertDuration || urlParams.alertColor || urlParams.defaultText || urlParams.position) {
                return {
                    alertDuration: urlParams.alertDuration || '3000',
                    alertColor: urlParams.alertColor || '#ff0000',
                    defaultText: urlParams.defaultText || 'Hello Stream!',
                    position: urlParams.position || 'center'
                };
            }

            // Then try localStorage
            const stored = localStorage.getItem(`overlayConfig_${userId}`);
            if (stored) {
                return JSON.parse(stored);
            }

            // Default config
            return {
                alertDuration: 3000,
                alertColor: '#ff0000',
                defaultText: 'Hello Stream!',
                position: 'center'
            };
        }

        // Update configuration URL
        function updateConfigUrl(userId, config) {
            const baseUrl = window.location.href.split('?')[0].split('#')[0];
            const configUrl = `${baseUrl}?userId=${userId}&alertDuration=${config.alertDuration}&alertColor=${encodeURIComponent(config.alertColor)}&defaultText=${encodeURIComponent(config.defaultText)}&position=${config.position}`;
            $('#configUrl').text(configUrl);
            $('#overlayUrl').text(configUrl.replace('#config', ''));
        }

        // Copy URL to clipboard
        function copyUrl(elementId) {
            const url = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            });
        }

        // Main execution
        $(document).ready(() => {
            const params = getUrlParams();
            const userId = params.userId || generateUserId();

            if (isConfig) {
                // Config page setup
                document.body.innerHTML = `
                    <div class="config-container">
                        <h1>Overlay Configuration</h1>
                        <div class="config-section">
                            <h2>User ID</h2>
                            <div class="config-input">
                                <label>Your Unique ID (save this to update your config later)</label>
                                <input type="text" id="userId" value="${userId}" readonly>
                            </div>
                        </div>
                        <div class="config-section">
                            <h2>Alert Settings</h2>
                            <div class="config-input">
                                <label>Alert Duration (ms)</label>
                                <input type="number" id="alertDuration" value="3000">
                            </div>
                            <div class="config-input">
                                <label>Alert Color</label>
                                <input type="color" id="alertColor" value="#ff0000">
                            </div>
                        </div>
                        <div class="config-section">
                            <h2>Text Settings</h2>
                            <div class="config-input">
                                <label>Default Text</label>
                                <input type="text" id="defaultText" value="Hello Stream!">
                            </div>
                            <div class="config-input">
                                <label>Position</label>
                                <select id="position">
                                    <option value="center">Center</option>
                                    <option value="top">Top</option>
                                    <option value="bottom">Bottom</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="saveConfig()">Save Configuration</button>
                        <div class="config-section">
                            <h2>Your URLs</h2>
                            <h3>Configuration Page URL (save this to make changes later):</h3>
                            <div id="configUrl"></div>
                            <button onclick="copyUrl('configUrl')">Copy Config URL</button>
                            
                            <h3>Overlay URL (use this in OBS):</h3>
                            <div id="overlayUrl"></div>
                            <button onclick="copyUrl('overlayUrl')">Copy Overlay URL</button>
                        </div>
                    </div>
                `;

                // Load saved config
                const config = loadConfig(userId);
                $('#alertDuration').val(config.alertDuration);
                $('#alertColor').val(config.alertColor);
                $('#defaultText').val(config.defaultText);
                $('#position').val(config.position);
                updateConfigUrl(userId, config);

            } else {
                // Overlay setup
                document.body.innerHTML = `
                    <div class="overlay-container">
                        <div id="alertBox"></div>
                        <div id="customText"></div>
                    </div>
                `;

                // Load configuration and handle actions
                const config = loadConfig(userId);

                if (params.action === 'alert') {
                    $('#alertBox')
                        .text(params.text || config.defaultText)
                        .css('background-color', config.alertColor)
                        .fadeIn()
                        .delay(parseInt(config.alertDuration))
                        .fadeOut();
                } else if (params.action === 'text') {
                    $('#customText')
                        .text(params.text || config.defaultText)
                        .css({
                            top: config.position === 'top' ? '10%' : 
                                 config.position === 'bottom' ? '90%' : '50%'
                        });
                }
            }
        });
    </script>
</body>
</html>
